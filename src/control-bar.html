<head>
  <link rel="stylesheet" href="control-bar.css" />
</head>
<div class="control-bar drag-region">
  <button class="close-button" id="close-btn">
    <img src="icons/xmark.svg" alt="Close" />
  </button>
  <div class="border-l border-gray-500 h-6"></div>
  <button class="icon-button" id="full-select">
    <img src="icons/display.svg" alt="Entire Screen" />
  </button>
  <div class="border-l border-gray-500 h-6"></div>
  <button class="icon-button" id="frame-select">
    <img src="icons/dashedRectangle.svg" alt="Frame Select" />
  </button>

  <div class="border-l border-gray-500 h-6"></div>
  <div class="export-container">
    <div class="border-l border-gray-500 h-6"></div>
    <div>
      <button class="control-bar-btn" id="export-btn">Export To...</button>
    </div>
  </div>

  <div class="border-l border-gray-500 h-6"></div>
  <div><button class="control-bar-btn" id="record-btn">Record</button></div>
</div>

<script>
  // Add an event listener to the close button to emit the close-control-bar event
  const closeButton = document.getElementById("close-btn");
  if (closeButton) {
    closeButton.addEventListener("click", () => {
      const { ipcRenderer } = require("electron");
      ipcRenderer.send("close-control-bar");
    });
  }

  // Add an event listener to the Export To button to emit the export-to event
  const exportButton = document.getElementById("export-btn");
  if (exportButton) {
    exportButton.addEventListener("click", () => {
      const { ipcRenderer } = require("electron");
      ipcRenderer.send("export-to");
    });
  }

  // Add an event listener to the Frame Select button to emit the show-overlay event
  const frameSelectButton = document.getElementById("frame-select");
  if (frameSelectButton) {
    frameSelectButton.addEventListener("click", () => {
      const { ipcRenderer } = require("electron");
      ipcRenderer.send("toggle-selection", "show-overlay");
    });
  }

  const fullSelectButton = document.getElementById("full-select");
  if (fullSelectButton) {
    fullSelectButton.addEventListener("click", () => {
      const { ipcRenderer } = require("electron");
      ipcRenderer.send("toggle-selection", "full-screen");
    });
  }

  const recordButton = document.getElementById("record-btn");
  if (recordButton) {
    recordButton.addEventListener("click", () => {
      const { ipcRenderer } = require("electron");

      // Check if frame is selected (you'll need to define this logic)
      const frameSelected = window.frameSelected || false;

      if (!frameSelected) {
        showTooltip(recordButton, "Please select a capture area first.");
        return;
      }

      ipcRenderer.send("start-recording");
    });
  }

  function showTooltip(targetElement, message) {
    let tooltip = document.createElement("div");
    tooltip.className = "tooltip";
    tooltip.innerText = message;
    document.body.appendChild(tooltip);

    // Position relative to the control bar
    const controlBar = document.querySelector(".control-bar");
    const rect = controlBar.getBoundingClientRect();

    // Centered horizontally, slightly above center vertically
    tooltip.style.top = `${rect.top + rect.height / 2 - 55}px`; // adjust -10 to move up more if you want
    tooltip.style.left = `${rect.left + rect.width / 2 - tooltip.offsetWidth / 2}px`;
    tooltip.style.opacity = "1";

    setTimeout(() => {
      tooltip.style.opacity = "0";
      setTimeout(() => {
        tooltip.remove();
      }, 200);
    }, 2500);
  }
</script>
