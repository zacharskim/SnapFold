<head>
  <link rel="stylesheet" href="control-bar.css" />
</head>
<div class="control-bar drag-region">
  <button class="close-button" id="close-btn">
    <img src="icons/xmark.svg" alt="Close" />
  </button>
  <div class="border-l border-gray-500 h-6"></div>
  <button class="icon-button">
    <img src="icons/display.svg" alt="Entire Screen" />
  </button>
  <div class="border-l border-gray-500 h-6"></div>
  <button class="icon-button">
    <img src="icons/dashedRectangle.svg" alt="Frame Select" />
  </button>

  <div class="border-l border-gray-500 h-6"></div>
  <div class="export-container">
    <div class="border-l border-gray-500 h-6"></div>
    <div>
      <button class="control-bar-btn">Export To...</button>
    </div>
  </div>

  <div class="border-l border-gray-500 h-6"></div>
  <div><button class="control-bar-btn">Record</button></div>
</div>

<div id="overlay" class="overlay hidden">
  <div class="dotted-rectangle" id="dotted-rectangle"></div>
</div>

<style>
  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
  }

  .hidden {
    display: none;
  }

  .dotted-rectangle {
    border: 2px dashed white;
    width: 300px;
    height: 200px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    cursor: move;
  }
</style>

<script>
  // Add an event listener to the close button to emit the close-control-bar event
  const closeButton = document.getElementById("close-btn");
  if (closeButton) {
    closeButton.addEventListener("click", () => {
      const { ipcRenderer } = require("electron");
      ipcRenderer.send("close-control-bar");
    });
  }

  // Add an event listener to the Export To button to emit the export-to event
  const exportButton = document.querySelector(".control-bar-btn");
  if (exportButton) {
    exportButton.addEventListener("click", () => {
      const { ipcRenderer } = require("electron");
      ipcRenderer.send("export-to");
    });
  }

  // Add an event listener to the Frame Select button to emit the show-overlay event
  const frameSelectButton = document.querySelector("img[alt='Frame Select']").parentElement;
  if (frameSelectButton) {
    frameSelectButton.addEventListener("click", () => {
      const { ipcRenderer } = require("electron");
      ipcRenderer.send("show-overlay");
    });
  }

  const overlay = document.getElementById("overlay");
  const rectangle = document.getElementById("dotted-rectangle");
  let isDragging = false;
  let offsetX, offsetY;

  // Show overlay when Frame Select button is clicked
  if (frameSelectButton) {
    frameSelectButton.addEventListener("click", () => {
      overlay.classList.remove("hidden");
    });
  }

  // Dragging functionality for the dotted rectangle
  rectangle.addEventListener("mousedown", (e) => {
    isDragging = true;
    offsetX = e.clientX - rectangle.offsetLeft;
    offsetY = e.clientY - rectangle.offsetTop;
  });

  document.addEventListener("mousemove", (e) => {
    if (isDragging) {
      rectangle.style.left = `${e.clientX - offsetX}px`;
      rectangle.style.top = `${e.clientY - offsetY}px`;
    }
  });

  document.addEventListener("mouseup", () => {
    isDragging = false;
  });

  // Hide overlay when clicking outside the rectangle
  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) {
      overlay.classList.add("hidden");
    }
  });
</script>
