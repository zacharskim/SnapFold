<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Overlay</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        background: transparent;
        overflow: hidden;
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
      }

      .dotted-rectangle {
        border: 2px dashed white;
        width: 300px;
        height: 200px;
        position: absolute;
        cursor: move;
        z-index: 100;
        pointer-events: auto;
        -webkit-user-select: none;
        outline: none !important;
        box-shadow: none !important;
        transform: translate(calc(50vw - 150px), calc(25vh - 100px));
        background-color: rgba(255, 255, 255, 0.4); /* Lighter and more transparent */
      }

      .resize-handle {
        position: absolute;
        width: 10px;
        height: 10px;
        background: white;
        cursor: pointer;
        z-index: 101;
      }

      .resize-handle.top-left {
        top: -5px;
        left: -5px;
        cursor: nwse-resize;
      }

      .resize-handle.top-right {
        top: -5px;
        right: -5px;
        cursor: nesw-resize;
      }

      .resize-handle.bottom-left {
        bottom: -5px;
        left: -5px;
        cursor: nesw-resize;
      }

      .resize-handle.bottom-right {
        bottom: -5px;
        right: -5px;
        cursor: nwse-resize;
      }
    </style>
  </head>
  <body>
    <div class="overlay"></div>

    <div class="dotted-rectangle" id="dotted-rectangle">
      <div class="resize-handle top-left" id="resize-top-left"></div>
      <div class="resize-handle top-right" id="resize-top-right"></div>
      <div class="resize-handle bottom-left" id="resize-bottom-left"></div>
      <div class="resize-handle bottom-right" id="resize-bottom-right"></div>
    </div>

    <script>
      const { ipcRenderer } = require("electron");
      const rectangle = document.getElementById("dotted-rectangle");
      const overlayEl = document.querySelector(".overlay");
      const resizeHandles = document.querySelectorAll(".resize-handle");

      let isDragging = false;
      let isResizing = false;
      let currentHandle = null;
      let offsetX, offsetY, startX, startY, startWidth, startHeight, startLeft, startTop;

      ipcRenderer.on("set-mode", (event, mode) => {
        console.log("Overlay mode:", mode);

        if (mode === "show-overlay") {
          // show selection UI
          document.body.classList.remove("recording");
          document.body.classList.add("selection");
        } else if (mode === "full-screen") {
          // show recording UI
          document.body.classList.remove("selection");
          document.body.classList.add("recording");

          // example: enable click-through
          remote.getCurrentWindow().setIgnoreMouseEvents(true, { forward: true });
        } else {
          console.log("Unknown mode:", mode);
        }
      });

      rectangle.addEventListener("mousedown", (e) => {
        if (e.target.classList.contains("resize-handle")) {
          isResizing = true;
          currentHandle = e.target;
          startX = e.clientX;
          startY = e.clientY;
          startWidth = rectangle.offsetWidth;
          startHeight = rectangle.offsetHeight;
          startLeft = rectangle.offsetLeft;
          startTop = rectangle.offsetTop;
          e.preventDefault();
        } else {
          isDragging = true;
          offsetX = e.clientX - rectangle.offsetLeft;
          offsetY = e.clientY - rectangle.offsetTop;
        }
      });

      document.addEventListener("mousemove", (e) => {
        if (isDragging) {
          rectangle.style.left = `${e.clientX - offsetX}px`;
          rectangle.style.top = `${e.clientY - offsetY}px`;
        } else if (isResizing) {
          const dx = e.clientX - startX;
          const dy = e.clientY - startY;

          if (currentHandle.id === "resize-top-left") {
            rectangle.style.width = `${Math.max(20, startWidth - dx)}px`;
            rectangle.style.height = `${Math.max(20, startHeight - dy)}px`;
            rectangle.style.left = `${startLeft + dx}px`;
            rectangle.style.top = `${startTop + dy}px`;
          } else if (currentHandle.id === "resize-top-right") {
            rectangle.style.width = `${Math.max(20, startWidth + dx)}px`;
            rectangle.style.height = `${Math.max(20, startHeight - dy)}px`;
            rectangle.style.top = `${startTop + dy}px`;
          } else if (currentHandle.id === "resize-bottom-left") {
            rectangle.style.width = `${Math.max(20, startWidth - dx)}px`;
            rectangle.style.height = `${Math.max(20, startHeight + dy)}px`;
            rectangle.style.left = `${startLeft + dx}px`;
          } else if (currentHandle.id === "resize-bottom-right") {
            rectangle.style.width = `${Math.max(20, startWidth + dx)}px`;
            rectangle.style.height = `${Math.max(20, startHeight + dy)}px`;
          }
        }
      });

      document.addEventListener("mouseup", () => {
        isDragging = false;
        isResizing = false;
        currentHandle = null;
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          ipcRenderer.send("close-overlay");
        }
      });
    </script>
  </body>
</html>
<!-- 
next, add full Screen add ability to switch between full screen and the other thing add the record bit to actually
collect the data ?! -->
